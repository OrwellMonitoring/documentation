<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-security/suricata">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/documentation/blog/rss.xml" title="Orwell RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documentation/blog/atom.xml" title="Orwell Atom Feed"><title data-rh="true">Suricata | Orwell</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://orwellmonitoring.github.io//documentation/security/suricata"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Suricata | Orwell"><meta data-rh="true" name="description" content="Suricata¬†is a Network Security Monitoring (NSM) tool that uses sets of community created and user defined signatures (also referred to as rules) to examine and process network traffic. Suricata can generate log events, trigger alerts, and drop traffic when it detects suspicious packets or requests to any number of different services running on a server."><meta data-rh="true" property="og:description" content="Suricata¬†is a Network Security Monitoring (NSM) tool that uses sets of community created and user defined signatures (also referred to as rules) to examine and process network traffic. Suricata can generate log events, trigger alerts, and drop traffic when it detects suspicious packets or requests to any number of different services running on a server."><link data-rh="true" rel="icon" href="/documentation/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://orwellmonitoring.github.io//documentation/security/suricata"><link data-rh="true" rel="alternate" href="https://orwellmonitoring.github.io//documentation/security/suricata" hreflang="en"><link data-rh="true" rel="alternate" href="https://orwellmonitoring.github.io//documentation/security/suricata" hreflang="x-default"><link rel="stylesheet" href="/documentation/assets/css/styles.7710f3fb.css">
<link rel="preload" href="/documentation/assets/js/runtime~main.e397893c.js" as="script">
<link rel="preload" href="/documentation/assets/js/main.1d6a9b4c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://orwellmonitoring.github.io" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/documentation/img/orwell_logo.png" alt="Orwell&#x27;s Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/documentation/img/orwell_logo.png" alt="Orwell&#x27;s Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Orwell</b></a><a class="navbar__item navbar__link navbar__link--active" href="/documentation/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/OrwellMonitoring" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation/core/api">Orwell Core</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation/deployment/system-agents">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/documentation/security/suricata">Security</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentation/security/suricata">Suricata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/security/infection-monkey">Infection Monkey</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation/metrics-export/create-os-boot-service">Metrics Collection</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/pythonPackage">Python Package</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/translators">Metrics Translators</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/documentation/">üè†</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Security</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Suricata</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Suricata</h1><p>Suricata¬†is a Network Security Monitoring (NSM) tool that uses sets of community created and user defined signatures (also referred to as rules) to examine and process network traffic. Suricata can generate log events, trigger alerts, and drop traffic when it detects suspicious packets or requests to any number of different services running on a server.<br>
<!-- -->Este reposit√≥rio tem como objetivo ter todos os fichieros necess√°rios para criar de formar simples e r√°pida um servi√ßo suricata em modo IPS, Intrusion Prevention System , a correr num kibana, utilizando elastic Search.<br>
<!-- -->De salientar que todas as regras que est√£o a ser utilizadas no suricata s√£o simples e ba≈õicas sendo da responsabilidade da testebed definir quais s√£o as regras que devem estar presentes.<br>
<!-- -->O suricata deve ter acesso a todos os pacotes da rede para eles o detetetar e dar as suas alarmisticas sendo que estes alarmes v√£o estar a ser enviadas para um slack, com todas as logs sendo que este slack deve tamb√©m ser alterado os tokens de acesso ao slack para funcionar.  </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="como-instalar-o-suricata">Como instalar o Suricata<a class="hash-link" href="#como-instalar-o-suricata" title="Direct link to heading">‚Äã</a></h2><p><strong>sudo add-apt-repository ppa:oisf/suricata-stable</strong><br>
<strong>sudo apt install suricata</strong>
<strong>sudo systemctl enable suricata.service</strong><br>
<!-- -->Output a receber:<br>
<!-- -->&quot;suricata.service is not a native service, redirecting to systemd-sysv-install.<br>
<!-- -->Executing: /lib/systemd/systemd-sysv-install enable suricata&quot;<br>
<strong>sudo systemctl stop suricata.service</strong>  -&gt; Se tudo estiver certo, deve-se parar de correr porque ainda n√£o h√° nada no suricata de regras  </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="configurar-o-yaml-do-suricata">Configurar o yaml do suricata<a class="hash-link" href="#configurar-o-yaml-do-suricata" title="Direct link to heading">‚Äã</a></h2><p><strong>sudo nano /etc/suricata/suricata.yaml</strong>  -&gt; Colocar la o nosso ficheiro do suricata.yaml que esta neste reposit√≥rio<br>
<!-- -->Caso se pretenda configurar uma nova interface basta, no ficheiro yaml nas linhas do <strong>af-packet</strong>: colocar a interface que se pretende e tamb√©m colocar um valor para o cluster id, salientar que este valor n√£o pode estar a ser utilizado nas outras interfaces.   </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="regras-do-suricata">Regras do Suricata<a class="hash-link" href="#regras-do-suricata" title="Direct link to heading">‚Äã</a></h2><p>Para importar regras basicas no suricata, basta ir buscar regras por default com o comando: <strong>sudo suricata-update</strong><br>
<!-- -->Nota, as regras do surica-update v√£o para o ficheiro : <strong>/var/lib/suricata/rules/suricata.rules</strong><br>
<!-- -->Podem tamb√©m serem criadas regras, e essas podem ser colocadas no <strong>/var/lib/suricata/rules/local.rules</strong> que j√° se encontra configurado no ficheiro yaml do suricata para aceitar as regras presentes neste ficheiro.  </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="testar-se-as-regras-est√£o-a-dar-corretamente">Testar se as regras est√£o a dar corretamente<a class="hash-link" href="#testar-se-as-regras-est√£o-a-dar-corretamente" title="Direct link to heading">‚Äã</a></h2><p><strong>sudo suricata -T -c /etc/suricata/suricata.yaml -v</strong></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="comandos-a-instalar">Comandos a instalar<a class="hash-link" href="#comandos-a-instalar" title="Direct link to heading">‚Äã</a></h2><p><strong>sudo apt update</strong><br>
<strong>sudo apt install jq</strong></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="come√ßar-a-correr-o-suricata">Come√ßar a correr o suricata<a class="hash-link" href="#come√ßar-a-correr-o-suricata" title="Direct link to heading">‚Äã</a></h2><p><strong>sudo systemctl start suricata.service</strong>
<strong>sudo systemctl status suricata.service</strong>
Notas:<br>
<!-- -->Esperar 1 a 2 minutos, suricata demora a correr<br>
<strong>sudo tail -f /var/log/suricata/suricata.log</strong>  e receber o output : data-- horas - Info - All AFP capture threads are running.  </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="colocar-o-suricata-em-ips">Colocar o Suricata em IPS<a class="hash-link" href="#colocar-o-suricata-em-ips" title="Direct link to heading">‚Äã</a></h2><p>Deve se ir a  /etc/default/suricata e alterar a linha:<br>
<strong>LISTENMODE=af-packet</strong> para <strong>LISTENMODE=nfqueue</strong></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="como-saber-em-que-modo-esta-o-suricata">Como saber em que modo esta o suricata<a class="hash-link" href="#como-saber-em-que-modo-esta-o-suricata" title="Direct link to heading">‚Äã</a></h2><p><strong>sudo systemctl status suricata.service</strong><br>
<!-- -->Nas linhas do fundo deve estar a indicar:Starting suricata in <strong>IPS</strong> (nfqueue) mode... done.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="logs-do-suricata">Logs do Suricata<a class="hash-link" href="#logs-do-suricata" title="Direct link to heading">‚Äã</a></h2><p><strong>cat  /var/log/suricata/fast.log</strong> ou  <strong>cat  /var/log/suricata/eve.json</strong><br>
<!-- -->As logs aqui presentes est√£o a ser enviadas para um slack.   </p><h3 class="anchor anchorWithStickyNavbar_mojV" id="pesquisar-por-logs-especificas">Pesquisar por logs especificas<a class="hash-link" href="#pesquisar-por-logs-especificas" title="Direct link to heading">‚Äã</a></h3><p>Fazendo o sid da regra pode-se fazer grep de todas as ocorrencias da regra.<br>
<strong>grep sid_number /var/log/suricata/fast.log</strong></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="logs-em-json">Logs em Json<a class="hash-link" href="#logs-em-json" title="Direct link to heading">‚Äã</a></h3><p><strong>sudo apt install jq</strong>
<strong>cat /var/log/suricata/eve.log</strong>
<strong>jq &#x27;select(.alert .signature_id==sid_number)&#x27; /var/log/suricata/eve.json</strong></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="configurar-a-ufw-para-enviar-trafego-para-o-suricata">Configurar a UFW para enviar trafego para o Suricata<a class="hash-link" href="#configurar-a-ufw-para-enviar-trafego-para-o-suricata" title="Direct link to heading">‚Äã</a></h2><p>A definir pelo sistema no nosso sistema atual estamos a usar os ficheiros presentes no reposit√≥rio sendo eles before.rules e before6.rules.<br>
<!-- -->Sitio onde colocar o before. rules, <strong>/etc/ufw/before.rules</strong><br>
<!-- -->Sitio onde colocar o before6. rules,<strong>/etc/ufw/before6.rules</strong><br>
<strong>sudo ufw enable</strong><br>
<!-- -->Neste ficheiro colocamos, as configura√ß√µes que para n√≥s serviam, para uma outra rede pode ser necess√°rio a altera√ß√£o deste ficheiro.  </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="como-instalar-o-kibana-e-elasticsearch">Como instalar o kibana e elasticSearch<a class="hash-link" href="#como-instalar-o-kibana-e-elasticsearch" title="Direct link to heading">‚Äã</a></h2><p><strong>curl -fsSL <a href="https://artifacts.elastic.co/GPG-KEY-elasticsearch" target="_blank" rel="noopener noreferrer">https://artifacts.elastic.co/GPG-KEY-elasticsearch</a> | sudo apt-key add -</strong><br>
<strong>echo &quot;deb <a href="https://artifacts.elastic.co/packages/7.x/apt" target="_blank" rel="noopener noreferrer">https://artifacts.elastic.co/packages/7.x/apt</a> stable main&quot; | sudo tee -a /etc/apt/sources.list.d/elastic-7.x.list</strong><br>
<strong>sudo apt update</strong><br>
<strong>sudo apt install elasticsearch kibana</strong> </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="configurar-o-elasticsearch">Configurar o elasticSearch<a class="hash-link" href="#configurar-o-elasticsearch" title="Direct link to heading">‚Äã</a></h2><p>Pode importar o ficheiro  elasticsearch.yml presente no nosso reposit√≥rio e colocar em  <strong>/etc/elasticsearch/elasticsearch.yml</strong> onde deve apenas alterar o campo onde diz &quot;your_private_ip&quot;.<br>
<!-- -->Onde encontrar o your_private ip:<br>
<!-- -->By default Elasticsearch is only accessible on localhost. Set a different<br>
<!-- -->address here to expose this node on the network:<br>
<!-- -->network.host: 192.168.0.1<br>
<!-- -->network.bind_host: <!-- -->[&quot;127.0.0.1&quot;, &quot;your_private_ip&quot;]<br>
<!-- -->By default Elasticsearch listens for HTTP traffic on the first free port it<br>
<!-- -->finds starting at 9200. Set a specific HTTP port here:  </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="como-correr-o-elasticsearch">Como correr o elasticSearch<a class="hash-link" href="#como-correr-o-elasticsearch" title="Direct link to heading">‚Äã</a></h2><p>Para as interfaces que pretende monitorizar colocar no comando abaixo
<strong>sudo ufw allow in on ethnumber</strong>
<strong>sudo ufw allow out on ethnumber</strong></p><p><strong>sudo systemctl start elasticsearch.service</strong><br>
<strong>sudo systemctl enable elasticsearch.service</strong>  </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="como-reduzir-o-espa√ßo-que-o-elasticsearch-ocupa">Como reduzir o espa√ßo que o elasticSearch ocupa<a class="hash-link" href="#como-reduzir-o-espa√ßo-que-o-elasticsearch-ocupa" title="Direct link to heading">‚Äã</a></h2><p><strong>sudo  vim /etc/elasticsearch/jvm.options</strong>
Dentro do ficheiro colocar:  </p><h1>JVM Heap Size - see /etc/elasticsearch/jvm.options</h1><p>-Xms2g<br>
<!-- -->-Xmx2g<br>
<!-- -->E assim fica com 2g para o elasticSearch,se pretender 1Gb, basta meter<br>
<!-- -->-Xms1g
-Xmx1g </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="passwords-geradas-de-forma-autom√°tica">Passwords geradas de forma autom√°tica<a class="hash-link" href="#passwords-geradas-de-forma-autom√°tica" title="Direct link to heading">‚Äã</a></h2><p>Correr os seguintes comandos: (NOTA ESTES COMANDOS S√ì PODEM SER CORRIDOS 1 VEZ LOGO DEVEM SER GUARDADOS NUM LOCAL SEGUROS AS PASSWORDS)<br>
<strong>cd /usr/share/elasticsearch/bin</strong><br>
<strong>sudo ./elasticsearch-setup-passwords auto</strong>  </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="configurar-o-kibana">Configurar o Kibana<a class="hash-link" href="#configurar-o-kibana" title="Direct link to heading">‚Äã</a></h2><p>Correr os seguintes comandos: (NOTA ESTES COMANDOS S√ì PODEM SER CORRIDOS 1 VEZ LOGO DEVEM SER GUARDADOS NUM LOCAL SEGUROS AS PASSWORDS)<br>
<strong>cd /usr/share/kibana/bin/</strong>
<strong>sudo ./kibana-encryption-keys generate -q</strong></p><p>Pode importar o nosso ficheiro de configura√ß√£o do kibana.yml e altera-lo em <strong>sudo vim /etc/kibana/kibana.yml</strong> , sendo apenas necess√°rio depois colocar passwords geradas substituir nos campos key pela respetiva key gerada anteriormente e trocar o &quot;your ip&quot; dentro do ficheiro yaml.  </p><p><strong>cd /usr/share/kibana/bin </strong><br>
<strong>sudo ./kibana-keystore add elasticsearch.username</strong> -&gt; colocar: kibana_system<br>
<strong>sudo ./kibana-keystore add elasticsearch.password</strong> -&gt; Password do kibana_system gerado em (sudo ./elasticsearch-setup-passwords auto)<br>
<strong>sudo systemctl start kibana.service</strong>
<strong>sudo systemctl enable kibana.service</strong></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="configurar-o-filebeat">Configurar o filebeat<a class="hash-link" href="#configurar-o-filebeat" title="Direct link to heading">‚Äã</a></h2><p><strong>curl -fsSL <a href="https://artifacts.elastic.co/GPG-KEY-elasticsearch" target="_blank" rel="noopener noreferrer">https://artifacts.elastic.co/GPG-KEY-elasticsearch</a> | sudo apt-key add -</strong><br>
<strong>echo &quot;deb <a href="https://artifacts.elastic.co/packages/7.x/apt" target="_blank" rel="noopener noreferrer">https://artifacts.elastic.co/packages/7.x/apt</a> stable main&quot; | sudo tee -a /etc/apt/sources.list.d/elastic-7.x.list</strong><br>
<strong>sudo apt update</strong><br>
<strong>sudo apt install filebeat</strong><br>
<strong>sudo nano /etc/filebeat/filebeat.yml</strong> e colocar :<br>
<!-- -->Starting with Beats version 6.0.0, the dashboards are loaded via the Kibana API.<br>
<!-- -->This requires a Kibana endpoint configuration.<br>
<!-- -->setup.kibana:<br>
<strong>host: &quot;your_private_ip:5601&quot;</strong><br>
<!-- -->output.elasticsearch:<br>
<!-- -->Array of hosts to connect to.<br>
<strong>hosts: <!-- -->[&quot;your_private_ip:9200&quot;]</strong>
Protocol - either <code>http</code> (default) or <code>https</code>.<br>
<!-- -->protocol: &quot;https&quot;<br>
<!-- -->Authentication credentials - either API key or username/password.<br>
<!-- -->api_key: &quot;id:api_key&quot;<br>
<!-- -->username: &quot;elastic&quot;<br>
<!-- -->password: &quot;pass do elastic gerado em  (sudo ./elasticsearch-setup-passwords auto)&quot;  </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="colocar-o-suricata-no-filebeat">Colocar o suricata no filebeat<a class="hash-link" href="#colocar-o-suricata-no-filebeat" title="Direct link to heading">‚Äã</a></h2><p><strong>sudo filebeat modules enable suricata</strong>  , output esperado : (Enabled suricata)<br>
<strong>sudo filebeat setup</strong> : Output esperado :<br>
<!-- -->Overwriting ILM policy is disabled. Set <code>setup.ilm.overwrite: true</code> for enabling.<br>
<!-- -->Index setup finished.<br>
<!-- -->Loading dashboards (Kibana must be running and reachable)<br>
<!-- -->Loaded dashboards<br>
<!-- -->Setting up ML using setup --machine-learning is going to be removed in 8.0.0. Please use the ML app instead.<br>
<!-- -->See more: <a href="https://www.elastic.co/guide/en/machine-learning/current/index.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/machine-learning/current/index.html</a><br>
<!-- -->It is not possible to load ML jobs into an Elasticsearch 8.0.0 or newer using the Beat.<br>
<!-- -->Loaded machine learning job configurations<br>
<!-- -->Loaded Ingest pipelines  </p><p>Ap√≥s isto executar<br>
<strong>sudo systemctl start filebeat.service</strong><br>
<strong>sudo systemctl enable filebeat.service</strong>  </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="dashboard-para-ver-os-dados">Dashboard para ver os dados<a class="hash-link" href="#dashboard-para-ver-os-dados" title="Direct link to heading">‚Äã</a></h2><p>http://your_ip:5601/
Colocar o user e a password do elastic que foi gerado anteriormente  </p><p>type:dashboard suricata  Alerts<br>
<!-- -->type:dashboard suricata  Events</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/documentation/deployment/system-agents"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">System Agents</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/documentation/security/infection-monkey"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Infection Monkey</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#como-instalar-o-suricata" class="table-of-contents__link toc-highlight">Como instalar o Suricata</a></li><li><a href="#configurar-o-yaml-do-suricata" class="table-of-contents__link toc-highlight">Configurar o yaml do suricata</a></li><li><a href="#regras-do-suricata" class="table-of-contents__link toc-highlight">Regras do Suricata</a></li><li><a href="#testar-se-as-regras-est√£o-a-dar-corretamente" class="table-of-contents__link toc-highlight">Testar se as regras est√£o a dar corretamente</a></li><li><a href="#comandos-a-instalar" class="table-of-contents__link toc-highlight">Comandos a instalar</a></li><li><a href="#come√ßar-a-correr-o-suricata" class="table-of-contents__link toc-highlight">Come√ßar a correr o suricata</a></li><li><a href="#colocar-o-suricata-em-ips" class="table-of-contents__link toc-highlight">Colocar o Suricata em IPS</a></li><li><a href="#como-saber-em-que-modo-esta-o-suricata" class="table-of-contents__link toc-highlight">Como saber em que modo esta o suricata</a></li><li><a href="#logs-do-suricata" class="table-of-contents__link toc-highlight">Logs do Suricata</a><ul><li><a href="#pesquisar-por-logs-especificas" class="table-of-contents__link toc-highlight">Pesquisar por logs especificas</a></li><li><a href="#logs-em-json" class="table-of-contents__link toc-highlight">Logs em Json</a></li></ul></li><li><a href="#configurar-a-ufw-para-enviar-trafego-para-o-suricata" class="table-of-contents__link toc-highlight">Configurar a UFW para enviar trafego para o Suricata</a></li><li><a href="#como-instalar-o-kibana-e-elasticsearch" class="table-of-contents__link toc-highlight">Como instalar o kibana e elasticSearch</a></li><li><a href="#configurar-o-elasticsearch" class="table-of-contents__link toc-highlight">Configurar o elasticSearch</a></li><li><a href="#como-correr-o-elasticsearch" class="table-of-contents__link toc-highlight">Como correr o elasticSearch</a></li><li><a href="#como-reduzir-o-espa√ßo-que-o-elasticsearch-ocupa" class="table-of-contents__link toc-highlight">Como reduzir o espa√ßo que o elasticSearch ocupa</a></li><li><a href="#passwords-geradas-de-forma-autom√°tica" class="table-of-contents__link toc-highlight">Passwords geradas de forma autom√°tica</a></li><li><a href="#configurar-o-kibana" class="table-of-contents__link toc-highlight">Configurar o Kibana</a></li><li><a href="#configurar-o-filebeat" class="table-of-contents__link toc-highlight">Configurar o filebeat</a></li><li><a href="#colocar-o-suricata-no-filebeat" class="table-of-contents__link toc-highlight">Colocar o suricata no filebeat</a></li><li><a href="#dashboard-para-ver-os-dados" class="table-of-contents__link toc-highlight">Dashboard para ver os dados</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Orwell Monitoring. Built with Docusaurus.</div></div></div></footer></div>
<script src="/documentation/assets/js/runtime~main.e397893c.js"></script>
<script src="/documentation/assets/js/main.1d6a9b4c.js"></script>
</body>
</html>